(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length){settings.single="metadata"}var data=$.data(elem,settings.single);if(data){return data}data="{}";var getData=function(data){if(typeof data!="string"){return data}if(data.indexOf("{")<0){data=eval("("+data+")")}};var getObject=function(data){if(typeof data!="string"){return data}data=eval("("+data+")");return data};if(settings.type=="html5"){var object={};$(elem.attributes).each(function(){var name=this.nodeName;if(name.match(/^data-/)){name=name.replace(/^data-/,"")}else{return true}object[name]=getObject(this.nodeValue)})}else{if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m){data=m[1]}}else{if(settings.type=="elem"){if(!elem.getElementsByTagName){return}var e=elem.getElementsByTagName(settings.name);if(e.length){data=$.trim(e[0].innerHTML)}}else{if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr){data=attr}}}}object=getObject(data.indexOf("{")<0?"{"+data+"}":data)}$.data(elem,settings.single,object);return object}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);$(function(){$("[data-toggle-ajax]").on("shown.bs.tab",function(b){var a=$(this);if(a.hasClass("loaded")){return}$(a.attr("data-target")).load(this.href,function(){a.addClass("loaded");var c=a.attr("data-callback");if(c){$('<span onclick="'+c+'"></span>').click()}})})});var cmplus=window.namespace||{_initIMEIForm:function(){},loadIMEIDetails:function(c){var b=this,a=$(c);if(a.val()){$.ajax({type:"POST",dataType:"html",data:{service_id:a.val()},url:a.attr("data-url"),success:function(d){if(b._isExpiredSesion(d)){return window.location.replace(login_url)}d=$.parseJSON(d);if(d.success){$(".was-inserted, div.error-box, div.success-box").remove();var e=$("#imei-service-info");e.html("").hide();$("#service-id").after(d.html);if(d.info){e.html(d.info).show();b.scrollToElm("#imei-unlock-content")}}else{if(d.error){b.showError(d.error)}}}})}},getModelList:function(b){var a=this,c=$(b);if(c.val()){$("#brand_txt").val(c.children("option").filter(":selected").text());$.ajax({type:"POST",dataType:"html",data:{brand_id:c.val(),service_id:$("#imei_order_service_id").val()},url:c.attr("data-url"),success:function(d){if(a._isExpiredSesion(d)){return window.location.replace(login_url)}d=$.parseJSON(d);if(d.success){$("#li_imei_order_rmobile").remove();$("#li_brand").after(d.html)}else{if(d.error){a.showError(d.error)}}}})}},getProviderList:function(b){var a=this,c=$(b);if(c.val()){$("input#country_txt").val(c.children("option").filter(":selected").text());$.ajax({type:"POST",dataType:"html",data:{country_id:c.val(),service_id:$("#imei_order_service_id").val()},url:c.attr("val-url"),success:function(d){if(a._isExpiredSesion(d)){return window.location.replace(login_url)}d=$.parseJSON(d);if(d.success){$("#li_imei_order_rprovider").remove();$("#li_country").after(d.html)}else{if(d.error){a.showError(d.error)}}}})}},placeIMEIOrder:function(){var b=this,a=$("#imei-unlock-form");if($("input#imei_order_imei").val().length!==15){b.showError("IMEI no válido.");return}$.ajax({type:"POST",dataType:"html",data:a.serialize(),url:a.attr("action"),success:function(c){b._onPlaceOrder(c)}})},initFileOrderForm:function(){var a=this;$("#file-unlock-form").ajaxForm({success:a._onPlaceOrder})},_onPlaceOrder:function(a){var b=cmplus;if(b._isExpiredSesion(a)){return window.location.replace(login_url)}a=$.parseJSON(a);if(a.success){b.showAlert("Success",a.msg);$("#mi_saldo").html(a.credit);b._resetOrderForm()}else{if(a.error){b.showAlert("Error",a.error)}}},scrollToElm:function(a){$("html, body").animate({scrollTop:($(a).position().top+$(a).scrollTop())},"slow");return this},showLoading:function(){$("#loading").modal();return this},showMask:function(){if($("#mask").length){$("#mask").show()}else{$('<div id="mask"></div>').prependTo("body")}var a=$(document).height();var b=$(document).width();$("#mask").css({width:b,height:a}).show()},hideLoading:function(){$("#loading").modal("toggle");return this},_resetOrderForm:function(){$(".was-inserted").remove();$("#imei-service-info").html("").hide();$('.unlock-form input[type="text"], .unlock-form select, .unlock-form textarea, .unlock-form [type="file"]').val("");return this},_preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},_isExpiredSesion:function(a){return/<form\s+id="login" [\S\s]*?<\/form>/gi.test(a)},dataTableDefaults:{oLanguage:{sLengthMenu:"Mostrar _MENU_ por página",sZeroRecords:"No hay nada para mostrar",sInfo:"Mostrando _START_ hasta _END_ de _TOTAL_ productos",sInfoEmtpy:"Mostrando 0 hasta 0 de 0 productos",sSearch:"Buscar",sInfoFiltered:"(de un total de _MAX_)"}},initProductsTable:function(c){var a=this,e=$("#prods_table");if(e.length){$.extend(a.dataTableDefaults,{aaSorting:[],bServerSide:true,sAjaxSource:c,fnDrawCallback:function(){f(this);$(".dataTables_filter input, .dataTables_length select").addClass("form-control")}});e=e.dataTable(a.dataTableDefaults);var d=$("#prods_table_filter input");d.unbind();d.bind("keyup",function(b){if(b.keyCode===13){e.fnFilter(this.value)}});var f=function(b){b.find("tbody tr").on("click",function(){var i=$(this),h=i.metadata();if(i.hasClass("details")||!h.desc){return}if(i.hasClass("closed")){$("tr.showing_details").hide("slow").remove();b.find("tbody tr.opened").addClass("closed").removeClass("opened success");var g=$("table#spTable tr.details").clone();g.addClass("showing_details");g.find("#prod_img img").attr("src",h.image);g.find("#prod_img a").attr("href",h.image);g.find("#prod_desc p").html(h.desc);i.after(g);g.show("slow");i.addClass("opened success").removeClass("closed")}else{b.find("tr.showing_details").hide("slow").remove();i.addClass("closed").removeClass("opened success")}})}}},initOrdersTable:function(c){var a=this,e=$("#orders_table");if(e.length){$.extend(a.dataTableDefaults,{aaSorting:[],bServerSide:true,sAjaxSource:c,fnDrawCallback:function(){f(this);$(".dataTables_filter input, .dataTables_length select").addClass("form-control")}});e=e.dataTable(a.dataTableDefaults);var d=$("#orders_table_filter input");d.unbind();d.bind("keyup",function(b){if(b.keyCode===13){e.fnFilter(this.value)}});var f=function(b){$(b).find("tbody tr").on("click",function(){var i=$(this),h=i.metadata();if(i.hasClass("details")){return}if(i.hasClass("closed")){$(b).find("tr.showing_details").hide("slow").remove();$(b).find("tbody tr.opened").addClass("closed").removeClass("opened");var g=$("table#spTable tr.details").clone();g.addClass("showing_details");g.find("span.order_details_service").html(h.service);g.find("span.order_details_credit").text(h.credit);if(h.imei){g.find("span.order_details_imei").text(h.imei);g.find("p#order_details_imei").show()}else{g.find("p#order_details_imei").hide()}if(h.file){g.find("span.order_details_file").text(h.file);g.find("p#order_details_file").show()}else{g.find("p#order_details_file").hide()}if(h.client){g.find("span.order_details_client").text(h.client);g.find("p#order_details_client").show()}if(h.clientEmail){g.find("span.order_details_client_email").text(h.clientEmail);g.find("p#order_details_client_email").show()}if(h.comments){g.find("span.order_details_comments").text(h.comments);g.find("p#order_details_comment").show()}else{g.find("p#order_details_comment").hide()}if(h.code){g.find("span#order_code").html(h.code);g.find("p#order_details_code").show()}else{g.find("p#order_details_code").hide()}i.after(g);$("tr.showing_details").show("slow");i.addClass("opened").removeClass("closed")}else{$(b).find("tr.showing_details").hide("slow").remove();i.addClass("closed").removeClass("opened")}})}}},initEvtsTable:function(c){var a=this,e=$("#evt_table");if(e.length){$.extend(a.dataTableDefaults,{aaSorting:[],bServerSide:true,sAjaxSource:c,fnDrawCallback:function(){f(this);$(".dataTables_filter input, .dataTables_length select").addClass("form-control")}});e=e.dataTable(a.dataTableDefaults);var d=$("#evt_table_filter input");d.unbind();d.bind("keyup",function(b){if(b.keyCode==13){e.fnFilter(this.value)}});var f=function(b){$(b).find("tbody tr").on("click",function(){var i=$(this),h=i.metadata();if(i.hasClass("details")){return}if(i.hasClass("closed")){$(b).find("tr.showing_details").hide("slow").remove();$(b).find("tbody tr.opened").addClass("closed").removeClass("opened");var g=$("table#spTable tr.details").clone();g.addClass("showing_details");g.find("span#created_by").text(h.creator);g.find("span#desc").html(h.desc);i.after(g);$("tr.showing_details").show("slow");i.addClass("opened").removeClass("closed")}else{$(b).find("tr.showing_details").hide("slow").remove();i.addClass("closed").removeClass("opened")}})}}},_checkOnlineStatus:function(d,c){var a=$(d),b=this;b.showLoading();$.ajax({type:"POST",dataType:"html",data:{},url:a.attr("val-url"),success:function(e){if(b._isExpiredSesion(e)){return window.location.href=logout_url}e=$.parseJSON(e);c(e);if(e.orders>0){history.go()}b.hideLoading()},error:function(){b.hideLoading()}})},checkOnlineOrderStatus:function(b){var a=this;a._checkOnlineStatus(b,function(c){var d="Se comprobó el estado de "+c.orders+" pedido(s).\n";d+="Hay "+c.accepted+" pedido(s) completado(s).\n";d+="Hay "+c.rejected+" pedido(s) rechazado(s).";alert(d)})},checkOnlineServicesStatus:function(b){var a=this;a._checkOnlineStatus(b,function(c){var d="Se comprobó el estado de los servicios(s).\n";d+="IMEI UNLOCK.\n";d+="Hay "+c.imei.new_services.length+" nuevo(s).\n";d+="Hay "+c.imei.del_services.length+" eliminado(s).\n";d+="Hay "+c.imei.updated_services.length+" modificado(s).\n";d+="FILE UNLOCK.\n";d+="Hay "+c.file.new_services.length+" nuevo(s).\n";d+="Hay "+c.file.del_services.length+" eliminado(s).\n";d+="Hay "+c.file.updated_services.length+" modificado(s).";alert(d)})},luhnCheck:function(b){var j=b.value,g=0,f=0,d=0,e=0,a=this;for(var c=j.length;c<14;c++){j=j+"0"}for(var c=1;c<14;c=c+2){var h=(j.charAt(c))*2+"0";f=f+parseInt(h.charAt(0))+parseInt(h.charAt(1))}for(var c=0;c<14;c=c+2){d=d+parseInt(j.charAt(c))}g=f+d;if(g%10===0){e=0}else{e=10-g%10}if(a.checknumber(e)){document.getElementById("imei2").value=e;document.getElementById("imei_order_imei").value=b.value+e}else{b.value=a.removeNotDigits(b.value);a.luhnCheck(b)}},checknumber:function(a){var b=/(^\d+$)|(^\d+\.\d+$)/;if(b.test(a)){return true}return false},removeNotDigits:function(a){var b=/(^\d+$)|(^\d+\.\d+$)/;for(var c=0;c<a.length;c++){if(!b.test(a.charAt(c))){a=a.replace(a.charAt(c),"0")}}return a},smsCount:function(d){var c=160-d.value.length;var b=$("label#smscount"),a=b.html();b.html(a.replace(/\d+/,c))},showError:function(a){this.showAlert("Error",a)},showAlert:function(a,c){var b=this;$(".error-box").remove();$("#imei-unlock-content").prepend(b["_html"+a](c));b.scrollToElm("#page_title")},_htmlError:function(a){return this._alertHtml("danger",a)},_htmlSuccess:function(a){return this._alertHtml("success",a)},_alertHtml:function(a,b){var d='<div class="alert alert-'+a+' error-box">';d+='<button aria-hidden="true" data-dismiss="alert" class="close" type="button">&times;</button>';d+=b;d+="</div>";return d},_adv_client_form_labels:{username:"Nombre de usuario del cliente",adv_user_credit:"Crédito",adv_user_adv_username:"Tu nombre de usuario",adv_user_adv_psw:"Tu contraseña"},postEditCredit:function(){var h=$("#advanced-client-popup"),g=this,c=false,f=h.find('input[type="text"], :password');h.find(".error-box").remove();f.each(function(){var a=$(this);if(!a.val()){h.find("h6").after(g._htmlError(g._adv_client_form_labels[a.attr("id")]+": Required."));c=true}});if(c){return}$.ajax({type:"POST",dataType:"html",data:h.find("input").serialize(),url:h.attr("data-url"),success:function(a){if(g._isExpiredSesion(a)){return window.location.replace(login_url)}a=$.parseJSON(a);if(a.success){if(a.selfcr){$("#mi_saldo").html(a.selfcr)}h.find('[data-dismiss="modal"]').click();f.val("")}else{if(a.errors){h.find("h6").after(g._htmlError(a.errors))}}}})}};$(document).ready(function(){if($("#imei_order_service_id").length){$("#imei_order_service_id").chosen()}}).ajaxStart(function(){cmplus.showLoading()}).ajaxStop(function(){cmplus.hideLoading()});